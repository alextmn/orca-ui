<div class="case-investigation-container">
  <div class="header">
    <div class="header-content">
      <div>
        <h1>Case Investigation Details</h1>
        <p class="subtitle">Review your case investigation status and details</p>
      </div>
      <div class="case-id" *ngIf="caseId">
        <span class="case-id-label">Case ID:</span>
        <span class="case-id-value">{{ caseId }}</span>
      </div>
    </div>
  </div>

  <div *ngIf="!reportData" class="loading-container">
    <div class="spinner"></div>
    <p class="loading-message">Loading your case...</p>
  </div>

  <div *ngIf="reportData" class="report-summary">
    <div class="section">
      <h2>Contact Information</h2>
      <div class="info-row">
        <div class="info-label">Full Name:</div>
        <div class="info-value">{{ reportData.fullName }}</div>
      </div>
      <div class="info-row">
        <div class="info-label">Email:</div>
        <div class="info-value">{{ reportData.email }}</div>
      </div>
    </div>

    <div class="section collapsible-section">
      <div class="section-header" (click)="toggleIncidentSection()">
        <h2>Incident Information</h2>
        <div class="toggle-icon">{{ isIncidentSectionExpanded ? 'â–¼' : 'â–¶' }}</div>
      </div>
      
      <div class="section-content" [ngClass]="{'collapsed': !isIncidentSectionExpanded}">
        <div class="subsection">
          <h3>Incident Details</h3>
          <div class="info-row">
            <div class="info-label">Your Wallet Address(es):</div>
            <div class="info-value">{{ reportData.victimWallet }}</div>
          </div>
          <div class="info-row" *ngIf="reportData.scammerWallet">
            <div class="info-label">Scammer Wallet Address(es):</div>
            <div class="info-value">{{ reportData.scammerWallet }}</div>
          </div>
          <div class="info-row" *ngIf="reportData.exchangePlatform">
            <div class="info-label">Exchange or Platform:</div>
            <div class="info-value">{{ reportData.exchangePlatform }}</div>
          </div>
          <div class="info-row" *ngIf="reportData.tokenName">
            <div class="info-label">Coin(s) / Token(s):</div>
            <div class="info-value">{{ reportData.tokenName }}</div>
          </div>
          <div class="info-row">
            <div class="info-label">Amount Lost (USD):</div>
            <div class="info-value">${{ reportData.amountLost.toFixed(2) }}</div>
          </div>
        </div>

        <div class="subsection">
          <h3>Incident Description</h3>
          <div class="description-box">
            <p>{{ reportData.incidentDescription }}</p>
          </div>
        </div>

        <div class="subsection" *ngIf="reportData.evidenceUrls">
          <h3>Evidence URLs</h3>
          <div class="description-box">
            <p class="evidence-url" *ngFor="let url of reportData.evidenceUrls.split('\n')">
              <a [href]="url" target="_blank" rel="noopener noreferrer">{{ url }}</a>
            </p>
          </div>
        </div>
      </div>
    </div>

    <!-- Case Insights Panel -->
    <div class="section">
        <h2>Case Progress Timeline</h2>
        <div class="comments-table-container">
          <div class="case-timeline">
            <div *ngFor="let update of caseDetails?.statusUpdates" class="timeline-item">
              <div class="timeline-header">
                <div class="timeline-status">{{ update.status }}</div>
                <div class="timeline-date">{{ formatDate(update.timestamp) }}</div>
              </div>
              <div class="timeline-content">
                <div markdown [data]="update.description"></div>
                <div class="file-links" *ngIf="update.markdownFileIds && update.markdownFileIds.length > 0">
                  <div class="file-links-header">Related Documents:</div>
                  <div class="file-links-container">
                    <a *ngFor="let fileId of update.markdownFileIds" 
                       (click)="openMarkdownFile(fileId)" 
                       class="file-link">
                      <span class="file-icon">ðŸ“„</span> {{ getFileTitle(fileId) }}
                    </a>
                  </div>
                </div>
              </div>
            </div>
            <div *ngIf="!caseDetails?.statusUpdates || (caseDetails?.statusUpdates || []).length === 0" class="no-timeline-items">
              No case insights available yet.
            </div>
          </div>
        </div>
    </div>
    
    <!-- Action section removed as requested -->
  </div>
</div>

<!-- Markdown Modal -->
<div class="markdown-modal" *ngIf="showMarkdownModal" (click)="closeMarkdownModal($event)">
  <div class="markdown-modal-content" (click)="$event.stopPropagation()">
    <div class="markdown-modal-header">
      <h2 *ngIf="selectedUpdate">{{ selectedUpdate?.updatedBy }} Report</h2>
      <h2 *ngIf="selectedMarkdownFile">{{ selectedMarkdownFile?.title }}</h2>
      <button class="close-button" (click)="closeMarkdownModal($event)">&times;</button>
    </div>
    <div class="markdown-modal-body">
      <div *ngIf="selectedUpdate" markdown [data]="selectedUpdate?.description"></div>
      <div *ngIf="selectedMarkdownFile" markdown [data]="selectedMarkdownFile?.content"></div>
    </div>
    <div class="markdown-modal-footer">
      <button class="close-modal-button" (click)="closeMarkdownModal($event)">Close</button>
    </div>
  </div>
</div>
